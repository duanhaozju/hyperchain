syntax = "proto3";

// Dispatcher response for Message distribute.
service Dispatcher {
    rpc Register(stream IMessage) returns(stream IMessage) {}
}

// IMessage is the wrapper of specific message used for internal component
message IMessage {
    uint64 id       = 1;
    Type type       = 2; // The basic message type.
    FROM from       = 3; // Define where the message come from.
    Event event     = 4; // Define the event type.
    bool ok         = 5; // used for response
    bytes payload   = 6; // The message body.
}

// RegisterMessage used by service component to connect to Dispatcher.
message RegisterMessage {
    string address      = 1;
    string port         = 2;
    string namespace    = 3;
    bytes payload       = 4; // retained field
}

enum Type {
    UNDEFINED = 0;
    REGISTER = 1;
    DISPATCH = 2;
    ADMIN = 3;
    RESPONSE = 4;
    EVENT = 5;
    SYNC_REQUEST = 6;
}

enum FROM {
    APISERVER = 0;
    CONSENSUS = 1;
    EXECUTOR  = 2;
    NETWORK   = 3;
    EVENTHUB  = 4;
    ADMINISTRATOR = 5;
}

enum Event {
    // 1.Admin event
    AddNamespaceEvent = 0;
    DeleteNamespaceEvent = 1;
    AdminResponseEvent = 2;

    // 2.Executor event
    VCResetEvent = 3;
    ValidationEvent = 4;
    CommitEvent = 5;
    ChainSyncReqEvent = 6;
    ExecutorToP2PEvent = 7;
    ExecutorToConsensusEvent = 8;

    SnapshotEvent = 9;
    DeleteSnapshotEvent = 10;
    ArchiveEvent = 11;

    //3.Self defined event
    StoreInvalidTransactionEvent = 12;
    ReceiveReplicaInfoEvent = 13;
    ReceiveSyncBlocksEvent = 14;
    ReceiveSyncRequestEvent = 15;
    ReceiveWorldStateSyncRequestEvent = 16;
    ReceiveWorldStateEvent = 17;
    ReceiveWsHandshakeEvent = 18;
    ReceiveWsAckEvent = 19;

    // 4.Miscellaneous event
    MemChainEvent = 20;
}